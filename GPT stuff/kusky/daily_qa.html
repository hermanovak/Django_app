<!--This code uses CSS to show or hide the table of input fields depending on whether a treatment room has been selected, 
and it uses dynamic HTML to display prompts/messages based on the user input. 
The instruction messages are also displayed using dynamic HTML and are shown or hidden when the user clicks on the question mark icon next to each row.-->

{% extends 'base.html' %}

{% block content %}
<h1>Daily QA Test</h1>
<form method="post">
    {% csrf_token %}
    <label for="treatment-room">Select a treatment room:</label>
    <select id="treatment-room" name="treatment-room" onchange="showTable()">
        <option value="">--Please select a room--</option>
        {% for room in rooms %}
        <option value="{{room}}">{{room}}</option>
        {% endfor %}
    </select>
    <br>
    <br>
    <div id="form-container" style="display:none;">
        <table>
            <tr>
                <th>Description</th>
                <th>User Input</th>
                <th>Prompt/Message</th>
                <th>Instruction</th>
            </tr>
            {% for i in range(10) %}
            <tr>
                <td><input type="text" name="desc{{i}}"></td>
                <td><input type="text" name="input{{i}}" onchange="checkInput(this, {{i}})"></td>
                <td><p id="prompt{{i}}"></p></td>
                <td><div class="instruction" id="instruction{{i}}" style="display:none;">{% lorem %}</div><span class="question-mark" onclick="toggleInstruction({{i}})">?</span></td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <br>
    <button type="submit">Submit</button>
</form>
<script>
function showTable() {
    var room = document.getElementById("treatment-room").value;
    if (room !== "") {
        document.getElementById("form-container").style.display = "block";
    } else {
        document.getElementById("form-container").style.display = "none";
    }
}

function toggleInstruction(index) {
    var instruction = document.getElementById("instruction" + index);
    if (instruction.style.display === "none") {
        instruction.style.display = "block";
    } else {
        instruction.style.display = "none";
    }
}

function checkInput(input, index) {
    var prompt = document.getElementById("prompt" + index);
    if (input.value === "") {
        prompt.innerHTML = "";
    } else if (isNaN(input.value)) {
        prompt.innerHTML = "Please enter a number";
    } else {
        prompt.innerHTML = "Value entered: " + input.value;
    }
}
</script>
{% endblock %}



{% extends 'base.html' %}

{% block content %}

<h2>Daily QA Test</h2>

<form method="POST">
  {% csrf_token %}
  <div class="form-group">
    <label for="treatment_room">Treatment Room:</label>
    <select id="treatment_room" name="treatment_room">
      <option value="1">Treatment Room 1</option>
      <option value="2">Treatment Room 2</option>
      <option value="3">Treatment Room 3</option>
      <option value="4">Treatment Room 4</option>
    </select>
  </div>
  <div class="form-group">
    <table class="table table-bordered" id="qa_table">
      <thead>
        <tr>
          <th>Description</th>
          <th>Measured Value</th>
          <th>Expected Value</th>
          <th>Prompt/Message</th>
        </tr>
      </thead>
      <tbody>
        {% for i in range(10) %}
        <tr>
          <td>Field Light Alignment</td>
          <td><input type="text" name="field_light_alignment_{{ i }}" required></td>
          <td>Pass</td>
          <td class="prompt"></td>
        </tr>
        <tr>
          <td>Central Axis Output</td>
          <td><input type="text" name="central_axis_output_{{ i }}" required></td>
          <td>Pass</td>
          <td class="prompt"></td>
        </tr>
        <tr>
          <td>Depth Dose</td>
          <td><input type="text" name="depth_dose_{{ i }}" required></td>
          <td>Pass</td>
          <td class="prompt"></td>
        </tr>
        <tr>
          <td>Flatness and Symmetry</td>
          <td><input type="text" name="flatness_and_symmetry_{{ i }}" required></td>
          <td>Pass</td>
          <td class="prompt"></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <button type="submit" class="btn btn-primary">Submit</button>
</form>

<script>
document.getElementById("treatment_room").addEventListener("change", function() {
  var table = document.getElementById("qa_table");
  var prompts = table.getElementsByClassName("prompt");
  for (var i = 0; i < prompts.length; i++) {
    prompts[i].innerHTML = "";
  }
});
var expected_values = {
  "field_light_alignment": "Pass",
  "central_axis_output": "Pass",
  "depth_dose": "Pass",
  "flatness_and_symmetry": "Pass"
};
document.querySelectorAll("#qa_table input[type=text]").forEach(function(input) {
  input.addEventListener("input", function() {
    var tr = input.parentElement.parentElement;
    var description = tr.firstElementChild.innerText;
    var expected_value = expected_values[description.toLowerCase().replace(/ /g, "_")];
    var prompt = tr.lastElementChild;
    if (input.value == expected_value) {
      prompt.innerHTML = "<span style='color:green'>Pass</span>";
    } else {
      prompt.innerHTML = "<span style='color:red'>Fail</span>";
    }
  });
});
</script>

{% endblock %}

