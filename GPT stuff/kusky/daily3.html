{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h1>Daily QA Test</h1>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
      <div class="form-group">
        <label for="treatment-room-select">Select Treatment Room</label>
        <select class="form-control" id="treatment-room-select">
          <option value="room1">Room 1</option>
          <option value="room2">Room 2</option>
          <option value="room3">Room 3</option>
          <option value="room4">Room 4</option>
        </select>
      </div>
    </div>
    <div class="col-md-9">
      <h3>Overall Test Result: <span id="test-result"></span></h3>
    </div>
  </div>

  <form id="daily-qa-form" method="POST">
    {% csrf_token %}
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Description</th>
          <th>User Input</th>
          <th>Check Result</th>
          <th>Prompt</th>
        </tr>
      </thead>
      <tbody>
        {% for i in 1|make_list %}
        <tr>
          <td>Check {{ i }}</td>
          <td>
            <input type="number" class="form-control" name="check{{ i }}" id="check{{ i }}" min="0" max="100">
          </td>
          <td>
            <i class="fa fa-question-circle" data-toggle="tooltip" data-placement="left" title="" data-original-title=""></i>
          </td>
          <td></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="submit" class="btn btn-primary">Save</button>
  </form>
</div>

{% endblock %}

{% block scripts %}
<script>
  $(function() {
    // Initialize tooltips
    $('[data-toggle="tooltip"]').tooltip();

    // Handle form submission
    $("#daily-qa-form").submit(function(event) {
      event.preventDefault();
      var formData = $(this).serialize();
      var selectedRoom = $("#treatment-room-select").val();
      formData += "&treatment_room=" + selectedRoom;
      $.ajax({
        url: "/submit_daily_qa",
        type: "POST",
        data: formData,
        success: function(response) {
          // Show success message
          $("#daily-qa-form").prepend('<div class="alert alert-success">Test saved successfully.</div>');
          setTimeout(function() {
            $(".alert-success").fadeOut();
          }, 3000);
          // Update test result
          if (response.passed) {
            $("#test-result").text("Passed");
            $("#test-result").css("color", "green");
          } else {
            $("#test-result").text("Failed");
            $("#test-result").css("color", "red");
          }
          // Clear form inputs
          $("#daily-qa-form :input").val("");
        },
        error: function(xhr) {
          // Show error message
          $("#daily-qa-form").prepend('<div class="alert alert-danger">Error saving test.</div>');
         
